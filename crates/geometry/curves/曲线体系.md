# 文档信息
- **文件名**: 曲线体系
- **原始文件名**: 曲线体系_id_11200000_level_2_parentId_11000000_time_20251218_Creator_lvwan01
- **Level**: 2
- **ID**: 11200000
- **ParentID**: 11000000
- **Time**: 20251218
- **Creator**: lvwan01

---

# 曲线体系 (Curves)

采用接口与基类结合的方式，区分 3D 空间曲线与 2D 参数曲线。核心代码位于 `SwhiGeometry\Geometry` 命名空间下。

## 1. 接口设计

### 1.1 ICurve
基础曲线接口，定义了曲线最基本的属性。
*   **属性**:
    *   `double Length { get; }` (长度)

### 1.2 ICurveXYZ
三维曲线接口，继承自 `ICurve` 和 `ITransformable`。
*   **属性**:
    *   `XYZ TangentAtStart { get; }` (起点切向量)
    *   `XYZ TangentAtEnd { get; }` (终点切向量)
    *   `XYZ StartPoint { get; }` (起点)
    *   `XYZ EndPoint { get; }` (终点)
*   **方法**:
    *   `bool IsLine()`
    *   `bool IsArc()`
    *   `bool IsPolyline()`
    *   `bool IsPolyCurve()`
    *   `XYZ GetPointAtDist(double dist)` (根据距离获取点)
    *   `double GetDistAtPoint(XYZ point)` (根据点获取距离)
    *   `bool IsPointOnCurve(XYZ source)` (判断点是否在曲线上)
    *   `XYZ TangentAt(double dist)` (获取指定距离处的切向量)
    *   `XYZ GetClosestPointWithinLine(XYZ testPoint, out double distance)` (获取最近点)
    *   `bool ClosestPoint(XYZ testPoint, out double t)` (计算最近点参数)

### 1.3 ICurveUV
二维参数曲线接口，继承自 `ICurve` 和 `ITransformable`。
*   **属性**:
    *   `UV TangentAtStart { get; }`
    *   `UV TangentAtEnd { get; }`
    *   `UV StartPoint { get; }`
    *   `UV EndPoint { get; }`
*   **方法**:
    *   与 `ICurveXYZ` 类似，但操作对象为 `UV` 点。

## 2. 基础类

### 2.1 Curve
通用曲线基类，实现了 `ICurve`。
*   **属性**:
    *   `int degree` (阶数)
    *   `bool periodic` (是否周期性)
    *   `bool rational` (是否有理)
    *   `List<double> weights` (权重)
    *   `List<double> knots` (节点向量)
    *   `Interval domain` (定义域)
    *   `bool closed` (是否闭合)
    *   `double Length`
*   **字段**:
    *   `private List<XYZ> points`
*   **方法**:
    *   `ToList()`: 序列化为 double 列表。
    *   `static Curve FromList(List<double> list)`: 反序列化。

### 2.2 NurbsCurve
NURBS 曲线的具体实现，继承自 `ICurve`。
*   **属性**:
    *   `int degree`
    *   `List<double> weights`
    *   `List<double> knots`
    *   `double Length` (未实现)
*   **字段**:
    *   `private List<XYZ> points`

## 3. 核心实现类 (XYZ & UV)

### 3.1 Line (直线)

#### 3.1.1 LineXYZ
三维直线段。
*   **私有字段**:
    *   `private XYZ p_start`
    *   `private XYZ p_end`
*   **属性**:
    *   `XYZ StartPoint`, `XYZ EndPoint`
    *   `XYZ MiddlePoint`
    *   `XYZ Direction` (单位向量)
    *   `XYZ Vector` (向量)
    *   `XYZ Origin`
    *   `double Length`
    *   `XYZ TangentAtStart`, `XYZ TangentAtEnd`
    *   `XYZ this[int idx]` (索引器)
*   **构造函数**:
    *   `LineXYZ()`
    *   `LineXYZ(XYZ startPoint, XYZ endPoint)`
*   **公有方法**:
    *   `static LineXYZ CreateByStartPointAndVector(XYZ startPoint, XYZ Vector)`
    *   `static LineXYZ CreateByStartPointAndEndPoint(XYZ startPoint, XYZ endPoint)`
    *   `double GetLength()`
    *   `void ChangeLengthFixStart(double len)`
    *   `void ChangeLengthFixEnd(double len)`
    *   `void ChangeDirectionFixStart(XYZ dir)`
    *   `void ChangeDirectionFixEnd(XYZ dir)`
    *   `void ChangeStartPoint(XYZ start)`
    *   `void ChangeEndPoint(XYZ end)`
    *   `void ChangeLocation(XYZ vector)`
    *   `LineXYZ Translation(XYZ vector)`
    *   `LineXYZ RotateByAxisAndDegree(XYZ axis, double degreeRadian)`
    *   `void Reverse()`
    *   `bool IsPointOnCurve(XYZ source, out double position)`
    *   `bool IsPointOnCurve(XYZ source)`
    *   `double DistanceTo(XYZ source)`
    *   `double AngleTo(LineXYZ line)`
    *   `XYZ GetClosestPoint(XYZ source)`
    *   `XYZ GetProjectPoint(XYZ source)`
    *   `XYZ GetClosestPointWithinLine(XYZ source, out double distance)`
    *   `bool ClosestPoint(XYZ testPoint, out double t)`
    *   `XYZ GetPointAtDist(double dist)`
    *   `double GetDistAtPoint(XYZ po)`
    *   `bool IsParallel(LineXYZ source)`
    *   `bool IsPerpendicular(LineXYZ source)`
    *   `bool IsOnOnePlane(LineXYZ source)`
    *   `bool IsOnPlane(PlaneXYZ plane)`
    *   `bool IsIntersectedOnPlaneExtended(LineXYZ source)`
    *   `bool IsCrossOver(LineXYZ source)`
    *   `bool IsBeCrossedOver(LineXYZ source)`
    *   `bool IsCrossedEachOther(LineXYZ source)`
    *   `bool IsIntersected(LineXYZ source)`
    *   `XYZ GetIntersectPointExtended(LineXYZ source)`
    *   `XYZ GetIntersectPoint(LineXYZ source)`
    *   `bool IsAlmostEqualTo(LineXYZ source)`
    *   `bool IsOverLoaded(LineXYZ source)`
    *   `XLineXYZ ToXLine()`
    *   `XLineXYZ GetMiddlePerpendicularXLineOnPlane(PlaneXYZ plane)`
    *   `LineXYZ OffsetBy2Direction(XYZ startDirection, XYZ endDirection, double offsetDistance)`
    *   `LineXYZ OffsetByDistance(double offsetDis, PlaneXYZ planeOffset)`
    *   `string ToString(...)`
    *   `List<double> ToList()`
    *   `static LineXYZ FromList(List<double> list)`
    *   `bool TransformTo(TransformXYZ transform, out LineXYZ line)`

#### 3.1.2 LineUV
二维直线段。
*   **私有字段**:
    *   `private UV p_start`, `p_end`
    *   `private PlaneXYZ base_plane`
*   **属性**:
    *   `UV StartPoint`, `EndPoint`, `MidPoint`, `Direction` ...
*   **公有方法**:
    *   提供了与 `LineXYZ` 类似的二维几何操作方法，如 `IsParallelTo`, `IsPerpendicular`, `IsCrossOver`, `GetIntersectPoint` 等。
    *   `XLineUV GetMiddlePerpendicularXLine()`

### 3.2 Arc (圆弧)

#### 3.2.1 ArcXYZ
三维空间圆弧。
*   **私有字段**:
    *   `private PlaneXYZ p_plane`
    *   `private XYZ p_center`
    *   `private double d_radius`
    *   `private double start_angle`, `end_angle`
    *   `private bool clock_wise`
*   **属性**:
    *   `XYZ Normal`, `StartRadiusVector`, `StartTangentVector` ...
    *   `XYZ StartPoint`, `EndPoint`, `MidPoint`, `Center`
    *   `Interval AngelInterval`
    *   `double AngleRadians`, `Length`, `Radius`
    *   `double StartAngle`, `EndAngle`, `StartAngleDegree`, `EndAngleDegree`
    *   `bool ClockWise`
    *   `PlaneXYZ Plane`
*   **构造函数**:
    *   支持通过 (Plane, Center, Radius, Angles), (3 Points), (Center, Start, End) 等方式构造。
*   **公有方法**:
    *   `double GetLength()`
    *   `XYZ GetPointAtDist(double dist)`
    *   `bool IsPointOnCurve(XYZ source)`
    *   `double GetDistAtPoint(XYZ source)`
    *   `XYZ GetClosestPoint(XYZ source)`
    *   `XYZ GetClosestPointWithinLine(XYZ source, out double distance)`
    *   `bool ClosestPoint(XYZ testPoint, out double t)`
    *   `void Reverse()`
    *   `ArcXYZ OffsetBy2Direction(...)`
    *   `ArcXYZ OffsetByDistance(double offsetDis)`
    *   `bool TransformTo(...)`
    *   `XYZ TangentAt(double dist)`

#### 3.2.2 ArcUV
二维参数空间圆弧。
*   **属性与方法**: 类似于 `ArcXYZ`，但在 UV 空间中定义。

#### 3.2.3 ArcRS
极坐标系下的圆弧（可能用于特殊场景）。
*   基于 `RS` 坐标定义。

### 3.3 Circle (圆)

#### 3.3.1 CircleXYZ
三维圆。
*   **私有字段**: `p_plane`, `p_normal`, `p_center`, `d_radius`.
*   **属性**: `Normal`, `Center`, `Length`, `Radius`, `Plane`, `Area`.
*   **方法**:
    *   `CreateBy3Point`
    *   `IsPointOnCurve`, `GetClosestPoint`
    *   `GetPointByAngle`, `GetAngleByPoint`
    *   `Get1sIntersectPointByBaseAndDirection` (获取交点)

#### 3.3.2 CircleUV
二维圆。
*   属性与方法类似 `CircleXYZ`。

### 3.4 Ellipse (椭圆)

#### 3.4.1 EllipseXYZ
*   **属性**:
    *   `double firstRadius`, `secondRadius`
    *   `PlaneXYZ plane`
    *   `Interval domain`, `trimDomain`
    *   `Box bbox`
    *   `double Area`, `Length`

#### 3.4.2 EllipseUV
*   二维椭圆，属性类似。

### 3.5 Polyline (多段线)

#### 3.5.1 PolylineXYZ
三维多段线，由一系列点连接而成。
*   **私有字段**: `private List<XYZ> _points`, `private bool is_closed`.
*   **属性**:
    *   `List<XYZ> Points`, `Vertices`
    *   `List<double> LengthListAtVertex`
    *   `bool IsClosed`
    *   `List<LineXYZ> Segments`
    *   `int Count`, `PointCount`, `SegmentCount`
    *   `XYZ StartPoint`, `EndPoint`
    *   `double Length`
    *   `LineXYZ this[int idx]`
*   **方法**:
    *   `bool Append(LineXYZ line)`
    *   `void AddPointAtEnd(XYZ point)`
    *   `XYZ GetPointAtDist(double dist)`
    *   `double GetTotalLengthAtIndex(int index)`
    *   `List<LineXYZ> GetSegments()`
    *   `LineXYZ SegmentAt(int index)`
    *   `XYZ PointAtIndex(int index)`
    *   `bool IsPointOnCurve(XYZ source)`
    *   `bool ClosestPoint(...)`
    *   `List<XYZ> GetIntersectPoints(LineXYZ source)`
    *   `PolylineXYZ Offset(double distance)`
    *   `List<XYZ> GetOffsetDirectionAtVetexes()`

#### 3.5.2 PolylineUV
二维多段线。

### 3.6 Polycurve (复合曲线)

#### 3.6.1 PolycurveXYZ
由多种类型的曲线片段（Line, Arc, Polyline）组成的复合曲线。
*   **属性**:
    *   `List<ICurveXYZ> Segments`
    *   `bool IsClosed`
    *   `double Length`
    *   `XYZ StartPoint`, `EndPoint`
    *   `List<XYZ> Points`, `Vertices`
*   **方法**:
    *   `bool Append(LineXYZ line)`
    *   `bool Append(ArcXYZ arc)`
    *   `bool Append(PolylineXYZ polyline)`
    *   `ICurveXYZ SegmentAt(int index)`
    *   `bool ClosestPoint(...)`
    *   `XYZ GetPointAtDist(double dist)`
    *   `bool IsPointOnCurve(XYZ source)`
    *   `PolycurveXYZ Offset(double distance)`
    *   `implicit operator PolycurveXYZ(PolylineXYZ polyline)` (隐式转换)

#### 3.6.2 PolycurveUV
二维复合曲线。

### 3.7 Spiral (螺旋线)
实现 `ICurve`，用于表示螺旋形状。
*   **属性**:
    *   `XYZ startPoint`, `endPoint`
    *   `PlaneXYZ plane`
    *   `double turns` (圈数，正为逆时针)
    *   `XYZ pitchAxis` (螺距轴)
    *   `double pitch` (螺距)
    *   `SpiralType spiralType` (枚举：Biquadratic, Clothoid 等)
    *   `double Length`
    *   `Interval domain`

### 3.8 XLine (无限长直线/构造线)
常作为辅助线使用。

#### 3.8.1 XLineXYZ
三维无限长直线。
*   **属性**:
    *   `XYZ BasePoint` (基点)
    *   `XYZ DirectionPoint`
    *   `XYZ Vector`, `Direction`
    *   `LineXYZ UnitLine`
*   **构造函数**:
    *   `XLineXYZ()`, `XLineXYZ(XYZ pointOnXLine, XYZ vector)`
*   **公有方法**:
    *   `static XLineXYZ CreateBy2Point(XYZ point1, XYZ point2)`
    *   `bool IsParallel(XLineXYZ source)`
    *   `bool IsPerpendicular(XLineXYZ source)`
    *   `XLineXYZ Translation(XYZ vector)`
    *   `XLineXYZ RotateByAxisAndDegree(...)`
    *   `void Reverse()`
    *   `bool IsPointOnCurve(XYZ source)`
    *   `double DistanceTo(XYZ source)`
    *   `XYZ GetClosestPoint(XYZ source)`
    *   `XYZ GetProjectPoint(XYZ source)`
    *   `bool IsOnPlane(PlaneXYZ plane)`
    *   `bool IsOnOnePlane(XLineXYZ source)`
    *   `bool IsIntersectedOnPlane(XLineXYZ source)`
    *   `XYZ GetIntersectPoint(XLineXYZ source)`
    *   `LineXYZ ToLineUnitLength()`

#### 3.8.2 XLineUV
二维无限长直线。
*   提供了类似的几何计算方法，如 `IsParallel`, `IsPerpendicular`, `GetIntersectPoint` 等。

---
# 文档关系 (Document Relationships)
- **上级 (Parent)**: [[几何内核.md]]
- **下级 (Children)**: 无
