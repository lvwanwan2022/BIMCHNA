# 文档信息
- **文件名**: 交互系统
- **原始文件名**: 交互系统_id_13000000_level_1_parentId_00000000_time_20251218_Creator_lvwan01
- **Level**: 1
- **ID**: 13000000
- **ParentID**: 00000000
- **Time**: 20251218
- **Creator**: lvwan01

---

# 交互系统 (Interaction System)

## 1. 模块定位与职责
本模块专注于**三维显示引擎的交互实现**。它是用户输入与三维场景（Render/Geometry）之间的桥梁，负责将用户的操作转化为视口、摄像机和场景对象的具体行为。

**核心原则**: 仅包含与三维引擎**强相关**的交互功能。
*   **包含**: 视图控制、物件拾取、视口管理、显隐控制、显示模式。
*   **不包含**: 文件 I/O、通用 UI 布局、非三维相关的业务逻辑（这些应由 App 层或各业务模块处理）。

## 2. 核心功能模块

### 2.1 视图控制 (View Control)
负责管理用户对观察角度的操纵。
*   **基础操作**: 
    *   **平移 (Pan)**: 摄像机位置在焦平面上的移动。
    *   **旋转 (Orbit/Rotate)**: 围绕焦点或自身的旋转。
    *   **缩放 (Zoom)**: 改变焦距或摄像机距离（Dolly）。
*   **交互模式 (Camera Mode)**:
    *   **Orbit (Default)**: 适合对象观察，围绕中心点旋转。
    *   **Game (WASD)**: 游戏式漫游，配合 WASD 键盘移动与鼠标视角控制。
*   **标准视图 (Standard Views)**: 
    *   提供 `Top`, `Bottom`, `Front`, `Back`, `Left`, `Right` 六视图快速切换。
    *   支持 ViewCube (右上角) 进行直观的视图定向。
*   **快捷操作**:
    *   **上下文菜单 (Context Menu)**: 双击鼠标中键 (Double Click Middle Mouse) 触发。
        *   `Zoom Extents`: 全景显示。
        *   `Zoom to Selected`: 聚焦选中对象。
        *   `Zoom to Box`: 框选缩放。
        *   `Zoom Random`: 随机聚焦（测试用）。
        *   `Previous Viewport`: 视图撤销。

### 2.2 物件拾取 (Object Picking)
负责从屏幕空间的二维输入映射到三维空间的对象选择。
*   **机制**: 
    *   **射线检测 (Ray Casting)**: 生成从摄像机出发穿过屏幕像素的射线。
    *   **GPU ID Buffer**: (可选优化) 利用颜色附件编码物体 ID 进行快速查找。
*   **功能**:
    *   **点选 (Click)**: 选择单个物体。
    *   **框选 (Box Select)**: 选择视锥体内的物体。
    *   **预选择高亮 (Pre-highlighting/Hover)**: 鼠标悬停时的视觉反馈。

### 2.3 视口控制 (Viewport Control)
管理三维渲染窗口的布局和属性。
*   **布局管理 (Layout)**: 
    *   `Single`: 单视口全屏。
    *   `Quad`: 四分屏视图。
    *   `Split`: 分割视图。
*   **投影模式 (Projection)**: 
    *   `Perspective`: 透视投影，符合人眼的近大远小效果。
    *   `Orthographic`: 正交投影，保持物体比例，适合工程制图。
*   **视口设置**:
    *   `Background Color`: 自定义视口背景色。
*   **视口同步**: 在多视口模式下，特定操作（如缩放）的同步逻辑。

### 2.4 摄像机控制 (Camera Control)
更底层的摄像机参数管理，服务于视图控制。
*   **参数管理**: FOV (视场角)、Near/Far Clipping Plane (裁剪面)。
*   **动画过渡**: 视图切换时的平滑插值（Tweening）。
*   **聚焦 (Focus/LookAt)**: 自动调整摄像机位置以充满显示选中物体或场景范围 (Zoom Extents)。

### 2.5 显隐控制 (Visibility Control)
管理场景中对象的可见性状态，与渲染引擎协作。
*   **环境辅助 (Environment)**:
    *   `Grid`: 显示/隐藏基准网格。
    *   `Axis`: 显示/隐藏世界坐标轴。
*   **对象级**: 隐藏/显示选中对象 (`Hide`, `Show`, `Isolate`).
*   **集合级**: 基于图层 (Layer) 或群组的可见性开关。
*   **过滤**: 根据对象类型（如只显示曲线，隐藏网格）进行过滤。

### 2.6 显示模式 (Display Modes)
控制三维场景的渲染风格。
*   `Wireframe`: 线框模式，仅显示几何拓扑结构。
*   `Shaded`: 着色模式，标准光照渲染。
*   `Material Preview`: 材质预览模式。
*   `X-Ray`: X光模式，半透明显示以观察内部结构。
*   `Translucent`: 透明模式。
*   `Artistic`: 艺术风格渲染模式。

## 3. 架构关系
*   **上游 (Input)**: 接收来自 `Input System` 的原始事件 (Mouse, Keyboard, Touch)。
*   **下游 (Output)**: 
    *   调用 `Kernel/Camera` 更新视图矩阵。
    *   调用 `Display Engine` 更新渲染状态（如高亮 buffer、显隐 flag）。
    *   查询 `Geometry Kernel` 进行精确的射线求交。

## 4. 现状与规划
*   **现状**: 部分逻辑仍耦合在 `app/ui` 中，正在逐步剥离。
*   **规划**: 建立统一的 `InteractionContext`，将上述功能封装为独立的 `Tool` 或 `Controller`，实现可配置的交互管线。

---
# 文档关系 (Document Relationships)
- **上级 (Parent)**: [[总框架.md]]
- **下级 (Children)**:
  - [[输入系统.md]]
  - [[交互实现机制.md]]
